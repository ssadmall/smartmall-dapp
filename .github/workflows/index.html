<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Mall DApp</title>
  <style>
    body { background:#0a1a2f;color:#fff;font-family:Arial; margin:0;padding-bottom:100px; }
    #langSwitcher{padding:10px;text-align:right;}
    section{display:none;padding:20px;margin:10px;background:#162447;border:2px solid #21e6c1;border-radius:8px;}
    section.active{display:block;}
    h2{margin-top:0;color:#21e6c1;}
    button{display:block;width:100%;padding:10px;margin:8px 0;background:#21e6c1;color:#0a1a2f;border:none;border-radius:5px;font-weight:bold;cursor:pointer;}
    button.small{display:inline-block;width:auto;margin:4px;padding:6px 12px;font-size:14px;}
    input{width:100%;padding:8px;margin:6px 0;border:none;border-radius:4px;background:#1f4068;color:#fff;}
    nav{position:fixed;bottom:0;left:0;right:0;display:flex;background:#162447;border-top:2px solid #21e6c1;}
    nav button{flex:1;background:#162447;color:#fff;padding:12px;border:none;font-weight:bold;}
    nav button.active{background:#21e6c1;color:#162447;}
    .date-tab-bar{display:flex;justify-content:space-between;background:#1b2c45;padding:6px;border-radius:8px;margin:12px 0;}
    .date-tab-bar button{flex:1;margin:0 2px;padding:6px 4px;background:#0f1c2e;color:#ccc;border:none;border-radius:6px;font-size:14px;cursor:pointer;}
    .date-tab-bar button.active{background:#21e6c1;color:#0a1a2f;font-weight:bold;}
    .product,.nft-item,.sale-item{background:#1f4068;border:1px solid #21e6c1;border-radius:6px;padding:10px;margin-bottom:10px;}
    .modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
    .modal-content{background:#fff;color:#000;padding:20px;border-radius:8px;width:300px;}
    #walletAction{margin-top:10px;}
    #walletHistory{margin-top:20px;max-height:200px;overflow-y:auto;}
    #walletHistory div{padding:6px 0;font-size:14px;}
    .pos{color:#4caf50;}  /* xanh */
    .neg{color:#f44336;}  /* ƒë·ªè */
  </style>
</head>
<body>
  <!-- 1. Language Switcher -->
  <div id="langSwitcher">
    <select id="langSelect">
      <option value="vi">Ti·∫øng Vi·ªát</option>
      <option value="en">English</option>
      <option value="es">Espa√±ol</option>
      <option value="fr">Fran√ßais</option>
      <option value="de">Deutsch</option>
      <option value="zh">‰∏≠Êñá</option>
      <option value="ja">Êó•Êú¨Ë™û</option>
      <option value="ko">ÌïúÍµ≠Ïñ¥</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="pt">Portugu√™s</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
      <option value="it">Italiano</option>
      <option value="nl">Nederlands</option>
      <option value="tr">T√ºrk√ße</option>
      <option value="sv">Svenska</option>
      <option value="id">Bahasa Indonesia</option>
      <option value="th">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
      <option value="ms">Bahasa Melayu</option>
    </select>
  </div>

  <!-- 2. Navigation -->
  <nav>
    <button id="btn-home" class="active" onclick="showSection('home')"></button>
    <button id="btn-session" onclick="showSection('session')"></button>
    <button id="btn-nft" onclick="showSection('nft')"></button>
    <button id="btn-wallet" onclick="showSection('wallet')"></button>
    <button id="btn-profile" onclick="showSection('profile')"></button>
  </nav>

  <!-- 3. Home -->
  <section id="home" class="active">
    <h2 id="homeTitle"></h2>
    <p id="adminNotice"></p>
  </section>

  <!-- 4. Session -->
  <section id="session">
    <h2 id="sessionTitle"></h2>
    <div class="date-tab-bar" id="sessionDateTabs"></div>
    <p><b id="selectedDateText"></b></p>
    <div id="registrationBox">
      <button id="registerBtn" onclick="showRegisterModal()"></button>
    </div>
    <div id="joinContainer" style="display:none">
      <button id="joinBtn" class="small" onclick="joinSession()"></button>
    </div>
    <div id="products" style="display:none">
      <h3 id="productsTodayTitle"></h3>
      <div id="productList"></div>
      <h3 id="productsPendingTitle"></h3>
      <div id="pendingSaleList"></div>
    </div>
  </section>

  <!-- 5. NFT -->
  <section id="nft">
    <h2 id="nftTitle"></h2>
    <div id="nftList"></div>
    <p id="totalSpentLabel"><span id="totalSpent">0</span></p>
  </section>

  <!-- 6. Wallet -->
  <section id="wallet">
    <h2 id="walletTitle"></h2>
    <p><span id="walletBalance">100000</span> SML</p>
    <button id="depositBtn" onclick="showDeposit()"></button>
    <button id="transferBtn" onclick="showTransfer()"></button>
    <button id="withdrawBtn" onclick="showWithdraw()"></button>
    <div id="walletAction"></div>
    <h3 id="walletHistoryTitle"></h3>
    <div id="walletHistory">Ch∆∞a c√≥ giao d·ªãch</div>
  </section>

  <!-- 7. Profile -->
  <section id="profile">
    <h2 id="profileTitle"></h2>
    <input id="username" type="text" placeholder=""/>
    <input id="phone"    type="text" placeholder=""/>
    <input id="fullname" type="text" placeholder=""/>
    <input id="bep20"    type="text" placeholder=""/>
    <button id="saveProfileBtn" onclick="saveProfile()"></button>
  </section>

  <!-- 8. Register Modal -->
  <div class="modal" id="registerModal">
    <div class="modal-content">
      <h3 id="registerModalTitle"></h3>
      <input type="number" id="registerAmount" placeholder=""/>
      <button id="registerModalConfirm" onclick="confirmRegister()"></button>
      <button id="registerModalCancel"  onclick="closeRegisterModal()"></button>
    </div>
  </div>

<script>
  // TRANSLATIONS (vi & en; others fallback to en)
  const translations = {
    vi: { navHome:"üè† Trang ch·ªß",navSession:"üïí Phi√™n",navNFT:"üßæ NFT",navWallet:"üí∞ V√≠",navProfile:"üë§ Th√¥ng tin",
          homeTitle:"üì¢ Th√¥ng b√°o t·ª´ Admin",adminNotice:"Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Smart Mall!",
          sessionTitle:"üïí Phi√™n giao d·ªãch",productsTodayTitle:"S·∫£n ph·∫©m b√°n trong phi√™n",productsPendingTitle:"S·∫£n ph·∫©m ƒëang treo b√°n (phi√™n ti·∫øp theo)",
          registerBtn:"ƒêƒÉng k√Ω phi√™n (20 000 SML)",joinBtn:"Tham gia phi√™n",
          nftTitle:"üßæ NFT c·ªßa t√¥i",totalSpentLabel:"T·ªïng chi ti√™u: ",
          walletTitle:"üí∞ V√≠ SML",depositBtn:"N·∫°p",transferBtn:"Chuy·ªÉn",withdrawBtn:"R√∫t",walletHistoryTitle:"L·ªãch s·ª≠ SML",
          profileTitle:"üë§ Th√¥ng tin c√° nh√¢n",usernamePh:"T√™n (vi·∫øt li·ªÅn)",phonePh:"S·ªë ƒëi·ªán tho·∫°i",fullnamePh:"H·ªç t√™n ƒë·∫ßy ƒë·ªß",bep20Ph:"ƒê·ªãa ch·ªâ v√≠ BEP20",saveProfileBtn:"L∆∞u th√¥ng tin",
          registerModalTitle:"Ph√≠ ƒëƒÉng k√Ω: 20 000 SML",registerModalConfirm:"X√°c nh·∫≠n",registerModalCancel:"H·ªßy",registerAmountPh:"S·ªë ti·ªÅn d·ª± ki·∫øn mua"},
    en: { navHome:"üè† Home",navSession:"üïí Session",navNFT:"üßæ My NFTs",navWallet:"üí∞ Wallet",navProfile:"üë§ Profile",
          homeTitle:"üì¢ Admin Notice",adminNotice:"Welcome to Smart Mall!",
          sessionTitle:"üïí Trading Session",productsTodayTitle:"Today's Listings",productsPendingTitle:"Pending Sales (Next Session)",
          registerBtn:"Register (20,000 SML)",joinBtn:"Join Session",
          nftTitle:"üßæ My NFTs",totalSpentLabel:"Total Spent: ",
          walletTitle:"üí∞ SML Wallet",depositBtn:"Deposit",transferBtn:"Transfer",withdrawBtn:"Withdraw",walletHistoryTitle:"SML History",
          profileTitle:"üë§ Profile",usernamePh:"Username (no spaces)",phonePh:"Phone number",fullnamePh:"Full name",bep20Ph:"BEP20 address",saveProfileBtn:"Save Profile",
          registerModalTitle:"Registration Fee: 20,000 SML",registerModalConfirm:"Confirm",registerModalCancel:"Cancel",registerAmountPh:"Expected amount"}
  };
  ["es","fr","de","zh","ja","ko","ru","pt","ar","it","nl","tr","sv","id","th","ms"]
    .forEach(l=>translations[l]=translations.en);

  function applyLanguage(lang){
    const t=translations[lang]||translations.en;
    // nav
    ["home","session","nft","wallet","profile"].forEach(id=>{
      document.getElementById("btn-"+id).innerText = t["nav"+id.charAt(0).toUpperCase()+id.slice(1)];
    });
    // sections/buttons
    document.getElementById("homeTitle").innerText   = t.homeTitle;
    document.getElementById("adminNotice").innerText = t.adminNotice;
    document.getElementById("sessionTitle").innerText       = t.sessionTitle;
    document.getElementById("productsTodayTitle").innerText = t.productsTodayTitle;
    document.getElementById("productsPendingTitle").innerText = t.productsPendingTitle;
    document.getElementById("registerBtn").innerText        = t.registerBtn;
    document.getElementById("joinBtn").innerText            = t.joinBtn;
    document.getElementById("nftTitle").innerText          = t.nftTitle;
    document.getElementById("totalSpentLabel").firstChild.nodeValue = t.totalSpentLabel;
    document.getElementById("walletTitle").innerText       = t.walletTitle;
    document.getElementById("depositBtn").innerText        = t.depositBtn;
    document.getElementById("transferBtn").innerText       = t.transferBtn;
    document.getElementById("withdrawBtn").innerText       = t.withdrawBtn;
    document.getElementById("walletHistoryTitle").innerText = t.walletHistoryTitle;
    document.getElementById("profileTitle").innerText      = t.profileTitle;
    document.getElementById("username").placeholder        = t.usernamePh;
    document.getElementById("phone").placeholder           = t.phonePh;
    document.getElementById("fullname").placeholder        = t.fullnamePh;
    document.getElementById("bep20").placeholder           = t.bep20Ph;
    document.getElementById("saveProfileBtn").innerText    = t.saveProfileBtn;
    document.getElementById("registerModalTitle").innerText= t.registerModalTitle;
    document.getElementById("registerModalConfirm").innerText = t.registerModalConfirm;
    document.getElementById("registerModalCancel").innerText  = t.registerModalCancel;
    document.getElementById("registerAmount").placeholder     = t.registerAmountPh;
  }

  // UTILS
  function fmt(n){return n.toLocaleString('vi-VN');}

  // STATE
  let walletBalance=100000, registeredFee=false, selectedDate=null;
  const registerFee=20000; let totalSpent=0;
  let products=[
    {id:'012345678901234567890123',name:'Tai nghe Bluetooth',price:50000,seller:'Admin'},
    {id:'123456789012345678901234',name:'Qu·∫°t mini USB',price:30000,seller:'Admin'},
    {id:'234567890123456789012345',name:'B√†n ph√≠m c∆° mini',price:70000,seller:'Admin'}
  ];
  let userNFT=[], pendingSales=[], walletHistory=[];

  // NAV & SECTIONS
  function showSection(id){
    document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
    document.getElementById('btn-'+id).classList.add('active');
  }

  // SESSION DATE TABS
  function generateSessionTabs(){
    const c=document.getElementById('sessionDateTabs'),
          t=document.getElementById('selectedDateText'),
          today=new Date();
    for(let i=0;i<7;i++){
      const d=new Date(today); d.setDate(today.getDate()+i);
      const lbl=`${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}`;
      const btn=document.createElement('button');
      btn.textContent=lbl;
      btn.onclick=()=>{
        document.querySelectorAll('.date-tab-bar button').forEach(x=>x.classList.remove('active'));
        btn.classList.add('active'); selectedDate=lbl; t.textContent=lbl;
      };
      if(i===0){btn.classList.add('active'); selectedDate=lbl; t.textContent=lbl;}
      c.appendChild(btn);
    }
  }

  // WALLET DISPLAY & HISTORY
  function updateWalletDisplay(){
    document.getElementById('walletBalance').innerText=fmt(walletBalance);
  }
  function addHistory(desc,delta){
    walletHistory.unshift({desc,delta,time:new Date().toLocaleString('vi-VN')});
    renderHistory();
  }
  function renderHistory(){
    const h=document.getElementById('walletHistory');
    if(!walletHistory.length){h.innerText='Ch∆∞a c√≥ giao d·ªãch';return;}
    h.innerHTML=walletHistory.map(x=>{
      const cls=x.delta<0?'neg':'pos';
      return `<div>[${x.time}] <span class="${cls}">${x.delta>0?'+':''}${fmt(Math.abs(x.delta))}</span> SML ‚Äì ${x.desc}</div>`;
    }).join('');
  }

  // REGISTER SESSION
  function showRegisterModal(){
    if(walletBalance<registerFee) return alert('Kh√¥ng ƒë·ªß SML!');
    document.getElementById('registerModal').style.display='flex';
  }
  function closeRegisterModal(){document.getElementById('registerModal').style.display='none';}
  function confirmRegister(){
    const amt=parseFloat(document.getElementById('registerAmount').value);
    if(isNaN(amt)||amt<=0) return alert('Nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá!');
    walletBalance-=registerFee; updateWalletDisplay(); addHistory('Ph√≠ ƒëƒÉng k√Ω phi√™n',-registerFee);
    registeredFee=true; closeRegisterModal();
    document.getElementById('registrationBox').innerHTML=`<p>ƒê√£ ƒëƒÉng k√Ω: ${fmt(amt)}</p>`;
    document.getElementById('joinContainer').style.display='block';
  }

  // JOIN SESSION
  function joinSession(){
    if(registeredFee){
      walletBalance+=registerFee; updateWalletDisplay(); addHistory('Ho√†n ph√≠ ƒëƒÉng k√Ω',+registerFee);
      registeredFee=false;
    }
    document.getElementById('products').style.display='block';
    renderProducts();
    renderPendingSales();
  }

  // PRODUCTS TODAY
  function renderProducts(){
    const list=document.getElementById('productList'); list.innerHTML='';
    products.forEach(p=>{
      list.innerHTML+=`
        <div class="product">
          <b>${p.name}</b><br>ID: ${p.id}<br>Gi√°: ${fmt(p.price)}<br>Ng∆∞·ªùi b√°n: ${p.seller}
          <button class="small" onclick="buyProduct('${p.id}')">Mua</button>
        </div>`;
    });
  }

  function buyProduct(id){
    const p=products.find(x=>x.id===id); if(!p)return;
    userNFT.push({...p,status:'bought'});
    products=products.filter(x=>x.id!==id);
    renderProducts(); renderNFTs();
  }

  // PENDING SALES: ch·ªâ hi·ªÉn th·ªã khi sellDate==selectedDate
  function renderPendingSales(){
    const list=document.getElementById('pendingSaleList');
    list.innerHTML='';
    if(!selectedDate) return;
    pendingSales
      .filter(s=>s.sellDate===selectedDate)
      .forEach(s=>{
        list.innerHTML+=`
          <div class="sale-item">
            <b>${s.name}</b><br>ID: ${s.id}<br>Gi√° b√°n: ${fmt(s.salePrice)}<br>
            Ph√≠: ${fmt(s.saleFee)}<br>Ng√†y g·ª≠i: ${s.sellDateTime}<br>Phi√™n: ${s.sellDate}<br>
            <button class="small" onclick="buyPendingSale('${s.id}')">Mua</button>
          </div>`;
      });
  }

  function buyPendingSale(id){
    const idx=pendingSales.findIndex(s=>s.id===id);
    if(idx===-1) return;
    const s=pendingSales[idx];
    if(walletBalance<s.salePrice) return alert('Kh√¥ng ƒë·ªß SML ƒë·ªÉ mua!');
    walletBalance-=s.salePrice; updateWalletDisplay(); addHistory(`Mua ${s.name}`, -s.salePrice);
    userNFT.push({...s,status:'bought'});
    totalSpent+=s.salePrice;
    pendingSales.splice(idx,1);
    renderPendingSales(); renderNFTs();
    alert(`B·∫°n ƒë√£ mua "${s.name}" th√†nh c√¥ng!`);
  }

  // NFT LOGIC
  function renderNFTs(){
    const c=document.getElementById('nftList'); c.innerHTML=''; let tot=0;
    if(!userNFT.length){c.innerText='Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.';}
    else userNFT.forEach(it=>{
      tot+=it.price;
      let h=`<div class="nft-item"><b>${it.name}</b><br>ID: ${it.id}<br>Gi√° mua: ${fmt(it.price)}<br>Ng∆∞·ªùi b√°n: ${it.seller}<br>`;
      if(it.status==='bought'){h+=`<button class="small" onclick="markPaid('${it.id}')">ƒê√£ thanh to√°n</button>`;}
      else if(it.status==='owned'){h+=`<button class="small" onclick="openNFT('${it.id}')">M·ªü</button>
           <button class="small" onclick="sellNFT('${it.id}')">B√°n</button>`;}
      else if(it.status==='pendingSale'){h+=`Tr·∫°ng th√°i: <i>Ch·ªù b√°n</i><br>Gi√° b√°n: ${fmt(it.salePrice)}<br>
           Ph√≠: ${fmt(it.saleFee)}<br>Ng√†y g·ª≠i: ${it.sellDateTime}<br>Phi√™n: ${it.sellDate}`;}
      h+='</div>'; c.innerHTML+=h;
    });
    document.getElementById('totalSpent').innerText=fmt(tot);
  }

  function markPaid(id){
    const it=userNFT.find(x=>x.id===id); if(!it)return;
    if(walletBalance<it.price)return alert('Kh√¥ng ƒë·ªß SML!');
    walletBalance-=it.price; updateWalletDisplay(); addHistory('Thanh to√°n',-it.price);
    it.status='owned'; renderNFTs();
  }

  function openNFT(id){
    const it=userNFT.find(x=>x.id===id); if(!it)return;
    const rf=it.price*0.9; walletBalance+=rf; updateWalletDisplay(); addHistory('Ho√†n NFT',rf);
    it.status='opened'; renderNFTs(); alert(`B·∫°n nh·∫≠n ${fmt(rf)} SML`);
  }

  function sellNFT(id){
    const it=userNFT.find(x=>x.id===id); if(!it)return;
    const profit=it.price*0.015, fee=it.price*0.034, salePrice=it.price+profit+fee;
    if(walletBalance<fee)return alert('Kh√¥ng ƒë·ªß SML tr·∫£ ph√≠!');
    walletBalance-=fee; updateWalletDisplay(); addHistory('Ph√≠ g·ª≠i b√°n',-fee);
    const now=new Date(), dt=now.toLocaleString('vi-VN');
    const tm=new Date(now); tm.setDate(now.getDate()+1);
    const sd=`${String(tm.getDate()).padStart(2,'0')}/${String(tm.getMonth()+1).padStart(2,'0')}`;
    it.status='pendingSale'; it.salePrice=salePrice; it.saleFee=fee; it.sellDateTime=dt; it.sellDate=sd;
    pendingSales.push({...it});
    renderNFTs(); renderPendingSales(); alert(`Ch·ªù b√°n phi√™n ${sd}`);
  }

  // WALLET ACTIONS
  function showDeposit(){
    document.getElementById('walletAction').innerHTML=`
      <h3>N·∫°p SML</h3>
      <p>Chuy·ªÉn USDT (BEP20) ƒë·∫øn:<br><code>0xYourWalletAddress</code></p>
      <input type="number" id="depositAmt" placeholder="S·ªë SML c·∫ßn n·∫°p"/>
      <button onclick="confirmDeposit()">X√°c nh·∫≠n n·∫°p</button>`;
  }
  function confirmDeposit(){
    const amt=parseFloat(document.getElementById('depositAmt').value);
    if(isNaN(amt)||amt<=0)return alert('Nh·∫≠p s·ªë h·ª£p l·ªá!');
    walletBalance+=amt; updateWalletDisplay(); addHistory('N·∫°p SML',amt);
    document.getElementById('walletAction').innerHTML='';
  }

  function showTransfer(){
    document.getElementById('walletAction').innerHTML=`
      <h3>Chuy·ªÉn SML</h3>
      <input type="text" id="transferTo" placeholder="Ng∆∞·ªùi nh·∫≠n"/>
      <input type="number" id="transferAmt" placeholder="S·ªë SML c·∫ßn chuy·ªÉn"/>
      <button onclick="confirmTransfer()">X√°c nh·∫≠n chuy·ªÉn</button>`;
  }
  function confirmTransfer(){
    const to=document.getElementById('transferTo').value.trim();
    const amt=parseFloat(document.getElementById('transferAmt').value);
    if(!to)return alert('Nh·∫≠p ng∆∞·ªùi nh·∫≠n!');
    if(isNaN(amt)||amt<=0)return alert('Nh·∫≠p s·ªë h·ª£p l·ªá!');
    if(walletBalance<amt)return alert('Kh√¥ng ƒë·ªß SML!');
    walletBalance-=amt; updateWalletDisplay(); addHistory(`Chuy·ªÉn cho ${to}`,-amt);
    document.getElementById('walletAction').innerHTML='';
  }

  function showWithdraw(){
    document.getElementById('walletAction').innerHTML=`
      <h3>R√∫t SML</h3>
      <input type="text" id="withdrawAddr" placeholder="ƒê·ªãa ch·ªâ BEP20"/>
      <input type="number" id="withdrawAmt" placeholder="S·ªë SML"/>
      <p>Ph√≠: 1.5%</p>
      <button onclick="confirmWithdraw()">X√°c nh·∫≠n r√∫t</button>`;
  }
  function confirmWithdraw(){
    const addr=document.getElementById('withdrawAddr').value.trim();
    const amt=parseFloat(document.getElementById('withdrawAmt').value);
    if(!addr)return alert('Nh·∫≠p ƒë·ªãa ch·ªâ r√∫t!');
    if(isNaN(amt)||amt<=0)return alert('Nh·∫≠p s·ªë h·ª£p l·ªá!');
    const fee=amt*0.015, total=amt+fee;
    if(walletBalance<total)return alert('Kh√¥ng ƒë·ªß SML!');
    walletBalance-=total; updateWalletDisplay(); addHistory(`R√∫t ${fmt(amt)} (+ ph√≠ ${fmt(fee)})`,-total);
    document.getElementById('walletAction').innerHTML='';
  }

  function saveProfile(){alert('Th√¥ng tin c√° nh√¢n ƒë√£ l∆∞u.');}

  // INIT
  window.onload = ()=>{
    generateSessionTabs();
    applyLanguage('vi');
    showSection('home');
    updateWalletDisplay();
    renderHistory();
  };
  document.getElementById('langSelect').addEventListener('change',e=>applyLanguage(e.target.value));
</script>
</body>
</html>
