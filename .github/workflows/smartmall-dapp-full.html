<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Mall DApp</title>
  <style>
    body { background: #0a1a2f; color: #fff; font-family: Arial, sans-serif; margin: 0; padding-bottom: 80px; }
    section { display: none; padding: 20px; margin: 10px; background: #162447; border-radius: 8px; border: 2px solid #21e6c1; }
    section.active { display: block; }
    h2 { color: #21e6c1; margin-top: 0; }
    button { display: block; width: 100%; padding: 10px; margin: 6px 0; background: #21e6c1; color: #0a1a2f; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
    button.small { width: auto; padding: 6px 12px; margin: 4px; font-size: 14px; }
    input { width: 100%; padding: 8px; margin: 6px 0; border: none; border-radius: 4px; background: #1f4068; color: #fff; }
    nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; background: #162447; border-top: 2px solid #21e6c1; }
    nav button { flex: 1; background: #162447; color: #fff; padding: 12px; border: none; font-weight: bold; }
    nav button.active { background: #21e6c1; color: #162447; }
    .date-tab-bar { display: flex; justify-content: space-between; background: #1b2c45; padding: 6px; border-radius: 8px; margin: 12px 0; }
    .date-tab-bar button { flex: 1; margin: 0 2px; background: #0f1c2e; color: #ccc; border: none; border-radius: 6px; padding: 6px 4px; font-size: 14px; cursor: pointer; }
    .date-tab-bar button.active { background: #21e6c1; color: #0a1a2f; font-weight: bold; }
    .product, .nft-item, .sale-item { background: #1f4068; border: 1px solid #21e6c1; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
    .modal { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: #fff; color: #000; padding: 20px; border-radius: 8px; width: 300px; }
  </style>
</head>
<body>

  <nav>
    <button id="btn-home"    class="active" onclick="showSection('home')">üè† Trang ch·ªß</button>
    <button id="btn-session"          onclick="showSection('session')">üïí Phi√™n</button>
    <button id="btn-nft"              onclick="showSection('nft')">üßæ NFT</button>
    <button id="btn-wallet"           onclick="showSection('wallet')">üí∞ V√≠</button>
    <button id="btn-profile"          onclick="showSection('profile')">üë§ Th√¥ng tin</button>
  </nav>

  <!-- TRANG CH·ª¶ -->
  <section id="home" class="active">
    <h2>üì¢ Th√¥ng b√°o t·ª´ Admin</h2>
    <p id="admin-notice">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Smart Mall - Giao d·ªãch th√¥ng minh, c·ªông ƒë·ªìng b·ªÅn v·ªØng!</p>
  </section>

  <!-- PHI√äN GIAO D·ªäCH -->
  <section id="session">
    <h2>üïí Phi√™n giao d·ªãch</h2>
    <div class="date-tab-bar" id="sessionDateTabs"></div>
    <p>Ng√†y ch·ªçn: <b id="selectedDateText"></b></p>
    <p>Gi·ªù: <b>12:00</b></p>
    <div id="registrationBox">
      <button onclick="showRegisterModal()">ƒêƒÉng k√Ω phi√™n (20.000 SML)</button>
    </div>
    <div id="joinBtn" style="display:none;">
      <button onclick="joinSession()">Tham gia phi√™n</button>
    </div>
    <div id="products" style="display:none;">
      <h3>S·∫£n ph·∫©m b√°n trong phi√™n</h3>
      <div id="productList"></div>
      <h3>S·∫£n ph·∫©m ƒëang treo b√°n (phi√™n ti·∫øp theo)</h3>
      <div id="pendingSaleList"></div>
    </div>
  </section>

  <!-- NFT C·ª¶A T√îI -->
  <section id="nft">
    <h2>üßæ NFT c·ªßa t√¥i</h2>
    <div id="nftList">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.</div>
    <p>T·ªïng chi ti√™u: <span id="totalSpent">0</span> USDT</p>
  </section>

  <!-- V√ç SML -->
  <section id="wallet">
    <h2>üí∞ V√≠ SML</h2>
    <p>S·ªë d∆∞: <span id="walletBalance">100000</span> SML</p>
  </section>

  <!-- TH√îNG TIN C√Å NH√ÇN -->
  <section id="profile">
    <h2>üë§ Th√¥ng tin c√° nh√¢n</h2>
    <input id="username" type="text" placeholder="T√™n (vi·∫øt li·ªÅn)" />
    <input id="phone"    type="text" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
    <input id="fullname" type="text" placeholder="H·ªç t√™n ƒë·∫ßy ƒë·ªß" />
    <input id="bep20"    type="text" placeholder="ƒê·ªãa ch·ªâ v√≠ BEP20" />
    <button onclick="saveProfile()">L∆∞u th√¥ng tin</button>
  </section>

  <!-- MODAL ƒêƒÇNG K√ù PHI√äN -->
  <div class="modal" id="registerModal">
    <div class="modal-content">
      <h3>Ph√≠ ƒëƒÉng k√Ω: 20.000 SML</h3>
      <input type="number" id="registerAmount" placeholder="S·ªë ti·ªÅn d·ª± ki·∫øn mua" />
      <button onclick="confirmRegister()">X√°c nh·∫≠n</button>
      <button onclick="closeRegisterModal()">H·ªßy</button>
    </div>
  </div>

<script>
  // D·ªØ li·ªáu ban ƒë·∫ßu
  let walletBalance = 100000;
  let registered = false;
  let selectedDate = null;
  const registerFee = 20000;
  let totalSpent = 0;

  // S·∫£n ph·∫©m do Admin ƒëƒÉng b√°n m·ªói phi√™n
  let products = [
    { id: '012345678901234567890123', name: 'Tai nghe Bluetooth', price: 50000, seller: 'Admin' },
    { id: '123456789012345678901234', name: 'Qu·∫°t mini USB',      price: 30000, seller: 'Admin' },
    { id: '234567890123456789012345', name: 'B√†n ph√≠m c∆° mini',    price: 70000, seller: 'Admin' }
  ];

  // Danh s√°ch s·∫£n ph·∫©m ng∆∞·ªùi d√πng ƒë√£ mua
  let userNFT = [];

  // C√°c s·∫£n ph·∫©m ƒëang treo b√°n t·ªõi phi√™n ti·∫øp theo
  let pendingSales = [];

  // Chuy·ªÉn hi·ªÉn th·ªã gi·ªØa c√°c section
  function showSection(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    document.getElementById("btn-" + id).classList.add("active");
  }

  // T·∫°o 7 n√∫t ch·ªçn ng√†y
  function generateSessionTabs() {
    const container = document.getElementById("sessionDateTabs");
    const txt = document.getElementById("selectedDateText");
    const today = new Date();
    for (let i=0; i<7; i++) {
      const d = new Date(today);
      d.setDate(today.getDate() + i);
      const label = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}`;
      const btn = document.createElement("button");
      btn.textContent = label;
      btn.onclick = () => {
        document.querySelectorAll(".date-tab-bar button").forEach(x=>x.classList.remove("active"));
        btn.classList.add("active");
        selectedDate = label;
        txt.textContent = label;
      };
      if (i===0) { btn.classList.add("active"); selectedDate = label; txt.textContent = label; }
      container.appendChild(btn);
    }
  }

  // Hi·ªán popup ƒëƒÉng k√Ω
  function showRegisterModal() {
    if (walletBalance < registerFee) {
      return alert("Kh√¥ng ƒë·ªß SML ƒëƒÉng k√Ω phi√™n!");
    }
    document.getElementById("registerModal").style.display = "flex";
  }

  // ƒê√≥ng popup ƒëƒÉng k√Ω
  function closeRegisterModal() {
    document.getElementById("registerModal").style.display = "none";
  }

  // X√°c nh·∫≠n ƒëƒÉng k√Ω
  function confirmRegister() {
    const amt = parseFloat(document.getElementById("registerAmount").value);
    if (isNaN(amt) || amt <= 0) return alert("Nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá!");
    walletBalance -= registerFee;
    document.getElementById("walletBalance").innerText = walletBalance;
    registered = true;
    closeRegisterModal();
    document.getElementById("registrationBox").innerHTML = `<p>ƒê√£ ƒëƒÉng k√Ω: ${amt} USDT</p>`;
    document.getElementById("joinBtn").style.display = "block";
  }

  // Tham gia phi√™n: hi·ªÉn th·ªã s·∫£n ph·∫©m
  function joinSession() {
    document.getElementById("products").style.display = "block";
    renderProducts();
    renderPendingSales();
  }

  // Hi·ªÉn th·ªã s·∫£n ph·∫©m trong phi√™n h√¥m nay
  function renderProducts() {
    const list = document.getElementById("productList");
    list.innerHTML = '';
    products.forEach(p => {
      list.innerHTML += `
        <div class="product">
          <b>${p.name}</b><br>ID: ${p.id}<br>Gi√°: ${p.price} USDT<br>Ng∆∞·ªùi b√°n: ${p.seller}
          <button class="small" onclick="buyProduct('${p.id}')">Mua</button>
        </div>`;
    });
  }

  // Hi·ªÉn th·ªã s·∫£n ph·∫©m treo b√°n cho ng√†y h√¥m sau
  function renderPendingSales() {
    const list = document.getElementById("pendingSaleList");
    list.innerHTML = '';
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate()+1);
    const label = `${String(tomorrow.getDate()).padStart(2,'0')}/${String(tomorrow.getMonth()+1).padStart(2,'0')}`;
    pendingSales
      .filter(s => s.sellDate === label)
      .forEach(s => {
        list.innerHTML += `
          <div class="sale-item">
            <b>${s.name}</b><br>
            ID: ${s.id}<br>
            Gi√° b√°n: ${s.salePrice.toFixed(2)} USDT<br>
            Ph√≠ g·ª≠i b√°n: ${s.saleFee.toFixed(2)} SML<br>
            Ng√†y g·ª≠i b√°n: ${s.sellDateTime}<br>
            Phi√™n b√°n: ${s.sellDate}
          </div>`;
      });
  }

  // Mua s·∫£n ph·∫©m ‚Üí th√™m v√†o NFT, tr·ª´ balance
  function buyProduct(id) {
    const p = products.find(x => x.id===id);
    if (!p) return;
    if (walletBalance < p.price) return alert("Kh√¥ng ƒë·ªß SML!");
    walletBalance -= p.price;
    document.getElementById("walletBalance").innerText = walletBalance;
    userNFT.push({ ...p, status: 'bought' });
    products = products.filter(x=>x.id!==id);
    renderProducts();
    renderNFTs();
  }

  // Hi·ªÉn th·ªã NFT theo tr·∫°ng th√°i
  function renderNFTs() {
    const container = document.getElementById("nftList");
    container.innerHTML = '';
    let tot = 0;
    if (userNFT.length===0) {
      container.innerText = 'Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o.';
    } else {
      userNFT.forEach(item => {
        tot += item.price;
        let html = `
          <div class="nft-item">
            <b>${item.name}</b><br>
            ID: ${item.id}<br>
            Gi√° mua: ${item.price} USDT<br>
            Ng∆∞·ªùi b√°n: ${item.seller}<br>`;
        if (item.status==='bought') {
          html += `<button class="small" onclick="markPaid('${item.id}')">ƒê√£ thanh to√°n</button>`;
        }
        else if (item.status==='awaitingSeller') {
          html += `Tr·∫°ng th√°i: <i>Ch·ªù x√°c nh·∫≠n</i><br>
                   <button class="small" onclick="confirmReceived('${item.id}')">ƒê√£ nh·∫≠n ti·ªÅn</button>`;
        }
        else if (item.status==='owned') {
          html += `
            <button class="small" onclick="openNFT('${item.id}')">M·ªü</button>
            <button class="small" onclick="sellNFT('${item.id}')">B√°n</button>`;
        }
        else if (item.status==='pendingSale') {
          html += `Tr·∫°ng th√°i: <i>ƒêang ch·ªù b√°n</i><br>
            Gi√° b√°n: ${item.salePrice.toFixed(2)} USDT<br>
            Ph√≠ ƒë√£ tr·ª´: ${item.saleFee.toFixed(2)} SML<br>
            Ng√†y g·ª≠i b√°n: ${item.sellDateTime}<br>
            Phi√™n: ${item.sellDate}`;
        }
        html += '</div>';
        container.innerHTML += html;
      });
    }
    document.getElementById("totalSpent").innerText = tot;
  }

  // Buyer b·∫•m "ƒê√£ thanh to√°n"
  function markPaid(id) {
    const item = userNFT.find(x=>x.id===id);
    if (!item) return;
    item.status = 'awaitingSeller';
    renderNFTs();
  }

  // Seller b·∫•m "ƒê√£ nh·∫≠n ti·ªÅn"
  function confirmReceived(id) {
    const item = userNFT.find(x=>x.id===id);
    if (!item) return;
    item.status = 'owned';
    renderNFTs();
  }

  // Buyer b·∫•m "M·ªü" ‚Üí ho√†n tr·∫£ 90%
  function openNFT(id) {
    const item = userNFT.find(x=>x.id===id);
    if (!item) return;
    const refund = item.price * 0.9;
    walletBalance += refund;
    document.getElementById("walletBalance").innerText = walletBalance;
    item.status = 'opened';
    renderNFTs();
    alert(`B·∫°n nh·∫≠n ƒë∆∞·ª£c ${refund.toFixed(2)} SML.`);
  }

  // Buyer b·∫•m "B√°n"
  function sellNFT(id) {
    const item = userNFT.find(x=>x.id===id);
    if (!item) return;
    const profit = item.price * 0.015;
    const fee    = item.price * 0.034;
    const salePrice = item.price + profit + fee;
    if (walletBalance < fee) {
      return alert("Kh√¥ng ƒë·ªß SML ƒë·ªÉ tr·∫£ ph√≠ g·ª≠i b√°n!");
    }
    walletBalance -= fee;
    document.getElementById("walletBalance").innerText = walletBalance;
    item.status = 'pendingSale';
    item.salePrice = salePrice;
    item.saleFee   = fee;
    const now = new Date();
    item.sellDateTime = now.toLocaleString('vi-VN');
    const tomorrow = new Date(now);
    tomorrow.setDate(now.getDate()+1);
    item.sellDate = `${String(tomorrow.getDate()).padStart(2,'0')}/${String(tomorrow.getMonth()+1).padStart(2,'0')}`;
    // ƒê∆∞a v√†o danh s√°ch ch·ªù b√°n ƒë·ªÉ hi·ªÉn th·ªã ·ªü phi√™n h√¥m sau
    pendingSales.push({ ...item });
    renderNFTs();
    renderPendingSales();
    alert(`S·∫£n ph·∫©m c·ªßa b·∫°n ƒë√£ ch·ªù b√°n v√†o phi√™n ${item.sellDate}. Gi√° b√°n: ${salePrice.toFixed(2)} USDT`);
  }

  function saveProfile() {
    alert("Th√¥ng tin c√° nh√¢n ƒë√£ l∆∞u.");
  }

  // Kh·ªüi t·∫°o khi load
  window.onload = () => {
    generateSessionTabs();
    showSection('home');
  };
</script>
</body>
</html>
