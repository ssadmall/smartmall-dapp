<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Mall DApp</title>
  <style>
    /* ====== CHUNG ====== */
    body { background:#0a1a2f; color:#fff; font-family:Arial,sans-serif; margin:0; padding-bottom:80px; }
    section { display:none; padding:20px; margin:10px; background:#162447; border:2px solid #21e6c1; border-radius:8px; }
    section.show { display:block; }
    h2 { color:#21e6c1; margin-top:0; }
    button,input,code { border:none; border-radius:4px; }
    button { background:#21e6c1; color:#0a1a2f; font-weight:bold; cursor:pointer; margin:6px 0; padding:8px; width:100%; }
    button.small { width:auto; padding:6px 12px; margin:4px 2px; }
    input { width:100%; padding:8px; margin:6px 0; background:#1f4068; color:#fff; }
    code { display:block; background:#1f4068; padding:8px; margin:8px 0; font-family:monospace; }

    /* ====== MARQUEE ====== */
    .marquee { overflow:hidden; white-space:nowrap; box-sizing:border-box; animation: marquee 12s linear infinite; }
    @keyframes marquee { 0%{transform:translateX(100%);}100%{transform:translateX(-100%);} }

    /* ====== NAV ====== */
    nav { position:fixed; bottom:0; left:0; right:0; display:flex; background:#162447; border-top:2px solid #21e6c1; }
    nav .nav-btn { flex:1; padding:8px 0; font-size:14px; background:#162447; color:#fff; cursor:pointer; }
    nav .nav-btn.active,nav .nav-btn:hover { background:#21e6c1; color:#162447; }

    /* ====== LANGUAGE ====== */
    #langSelect { position:fixed; top:10px; right:10px; background:#1f4068; color:#fff; padding:4px 8px; border:none; border-radius:4px; z-index:1000; }

    /* ====== DATE TABS ====== */
    .date-tab-bar { display:flex; overflow-x:auto; background:#1b2c45; padding:6px; border-radius:8px; margin:12px 0; }
    .date-tab-bar button { flex:0 0 auto; margin:0 4px; padding:6px 12px; background:#0f1c2e; color:#ccc; font-size:13px; cursor:pointer; border:none; white-space:nowrap; }
    .date-tab-bar button.active { background:#21e6c1; color:#162447; font-weight:bold; }

    /* ====== LIST ====== */
    .list { display:flex; flex-direction:column; gap:10px; }
    .product, .sale-item, .nft-item { padding:10px; border-radius:6px; color:#fff; }

    /* ====== MODAL ====== */
    .modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal.show { display:flex!important; }
    .modal-content { background:#fff; color:#000; padding:20px; border-radius:8px; width:90%; max-width:320px; }

    /* ====== TABLE ====== */
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th,td { border:1px solid #21e6c1; padding:6px; font-size:14px; }
    th { background:#1b2c45; }

    /* ====== POS/NEG ====== */
    .pos { color:#4caf50; }
    .neg { color:#f44336; }

    /* ====== RESPONSIVE ====== */
    @media(max-width:480px){
      nav .nav-btn { font-size:12px; padding:6px 0; }
      .date-tab-bar button { padding:6px 8px; font-size:12px; }
      button,input { font-size:14px; }
    }
  </style>
</head>
<body>

  <!-- Language selector -->
  <select id="langSelect">
    <option value="vi">üáªüá≥ Ti·∫øng Vi·ªát</option>
    <option value="en">üá¨üáß English</option>
  </select>

  <!-- LOGIN -->
  <section id="login" class="show">
    <h2 data-i18n-key="login_title">üîë ƒêƒÉng nh·∫≠p</h2>
    <input id="usernameInput" data-i18n-key="login_input" placeholder="Nh·∫≠p username (vi·∫øt li·ªÅn)"/>
    <button id="loginBtn" data-i18n-key="login_button">Ti·∫øp t·ª•c</button>
  </section>

  <!-- APP -->
  <div id="app" style="display:none">

    <!-- NAV -->
    <nav>
      <button id="btn-home"    class="nav-btn" onclick="showSection('home')"    data-i18n-key="nav_home">üè† Trang ch·ªß</button>
      <button id="btn-session" class="nav-btn" onclick="showSection('session')" data-i18n-key="nav_session">‚è±Ô∏è Phi√™n</button>
      <button id="btn-nft"     class="nav-btn" onclick="showSection('nft')"     data-i18n-key="nav_nft">üßæ NFT</button>
      <button id="btn-wallet"  class="nav-btn" onclick="showSection('wallet')"  data-i18n-key="nav_wallet">üí∞ V√≠</button>
      <button id="btn-profile" class="nav-btn" onclick="showSection('profile')" data-i18n-key="nav_profile">üë§ Th√¥ng tin</button>
    </nav>

    <!-- HOME -->
    <section id="home">
      <h2 data-i18n-key="home_title">üì¢ Th√¥ng b√°o t·ª´ Admin</h2>
      <div class="marquee">
        <span id="admin-notice" data-i18n-key="home_notice">
          Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Smart Mall ‚Äì Giao d·ªãch th√¥ng minh, c·ªông ƒë·ªìng b·ªÅn v·ªØng!
        </span>
      </div>
    </section>

    <!-- SESSION -->
    <section id="session">
      <h2 data-i18n-key="session_title">üïí Phi√™n giao d·ªãch</h2>
      <div class="date-tab-bar" id="sessionDateTabs"></div>
      <p><span data-i18n-key="session_selected">Ng√†y phi√™n ƒë√£ ch·ªçn:</span> <b id="selectedDateText"></b></p>
      <div id="registrationBox">
        <button onclick="showRegisterModal()" data-i18n-key="session_register_btn">
          ƒêƒÉng k√Ω phi√™n (20 000 SML)
        </button>
      </div>
      <div id="joinContainer" style="display:none">
        <button class="small" onclick="joinSession()" data-i18n-key="session_join_btn">
          Tham gia phi√™n
        </button>
      </div>
      <div id="products" style="display:none">
        <h3 data-i18n-key="session_products_today">S·∫£n ph·∫©m phi√™n h√¥m nay</h3>
        <div id="productList" class="list"></div>
        <h3 data-i18n-key="session_pending_sales">S·∫£n ph·∫©m treo b√°n</h3>
        <div id="pendingSaleList" class="list"></div>
      </div>
    </section>

    <!-- NFT -->
    <section id="nft">
      <h2 data-i18n-key="nft_title">üßæ NFT c·ªßa t√¥i</h2>
      <div id="nftList">Ch∆∞a c√≥ s·∫£n ph·∫©m.</div>
      <p>
        <span data-i18n-key="nft_total_spent">T·ªïng chi ti√™u:</span>
        <span id="totalSpent">0</span>
      </p>
      <h3 data-i18n-key="nft_history_title">L·ªãch s·ª≠ NFT</h3>
      <ul id="nftHistory">Ch∆∞a c√≥ l·ªãch s·ª≠.</ul>
    </section>

    <!-- WALLET -->
    <section id="wallet">
      <h2 data-i18n-key="wallet_title">üí∞ V√≠ SML</h2>
      <p>
        <span data-i18n-key="wallet_balance">S·ªë d∆∞:</span>
        <span id="walletBalance">100 000</span> SML
      </p>
      <div class="wallet-tabs">
        <button onclick="showDeposit()"   data-i18n-key="wallet_deposit">N·∫°p</button>
        <button onclick="showTransfer()"  data-i18n-key="wallet_transfer">Chuy·ªÉn</button>
        <button onclick="showWithdraw()"  data-i18n-key="wallet_withdraw">R√∫t</button>
      </div>
      <div id="walletAction"></div>
      <h3 data-i18n-key="wallet_tx_history">L·ªãch s·ª≠ giao d·ªãch</h3>
      <div id="walletHistory">Ch∆∞a c√≥ giao d·ªãch.</div>
      <h3 data-i18n-key="wallet_req_history">L·ªãch s·ª≠ y√™u c·∫ßu n·∫°p/r√∫t</h3>
      <table>
        <thead>
          <tr>
            <th data-i18n-key="req_type">Lo·∫°i</th>
            <th data-i18n-key="req_sml">SML</th>
            <th data-i18n-key="req_usdt">USDT c·∫ßn</th>
            <th data-i18n-key="req_addr">ƒê·ªãa ch·ªâ</th>
            <th data-i18n-key="req_time">Th·ªùi gian</th>
            <th data-i18n-key="req_status">Tr·∫°ng th√°i</th>
          </tr>
        </thead>
        <tbody id="requestHistory"></tbody>
      </table>
    </section>

    <!-- PROFILE -->
    <section id="profile">
      <h2 data-i18n-key="profile_title">üë§ Th√¥ng tin c√° nh√¢n</h2>
      <p><span data-i18n-key="profile_username">Username:</span> <b id="profileUsername"></b></p>
      <input id="phone"    placeholder="S·ªë ƒëi·ªán tho·∫°i"/>
      <input id="fullname" placeholder="H·ªç t√™n ƒë·∫ßy ƒë·ªß"/>
      <input id="bep20"    placeholder="ƒê·ªãa ch·ªâ v√≠ BEP20"/>
      <button onclick="saveProfile()" data-i18n-key="profile_save">L∆∞u th√¥ng tin</button>

      <div id="referralSection" style="margin-top:20px;">
        <h3 data-i18n-key="profile_referral">üîó Link gi·ªõi thi·ªáu</h3>
        <p><a href="#" id="referralLink" target="_blank"></a></p>
        <p><span data-i18n-key="profile_direct">Gi·ªõi thi·ªáu tr·ª±c ti·∫øp:</span> <span id="directRefCount">0</span></p>
        <p><span data-i18n-key="profile_team">ƒê·ªôi nh√≥m:</span> <span id="teamRefCount">0</span></p>
      </div>

      <!-- VIP & S-LEVEL -->
      <div id="ranks" style="margin-top:20px; padding:10px; background:#1f4068; border-radius:6px;">
        <h3>üéñÔ∏è C·∫•p b·∫≠c c·ªßa b·∫°n</h3>
        <p>VIP-Level: <b id="vipLevel">VIP0</b> (<span id="vipDays">0</span> ng√†y tham gia)</p>
        <p>T·ª∑ l·ªá l·ª£i nhu·∫≠n: <b id="vipProfitRate">1.5%</b></p>
        <hr style="border-color:#21e6c1; margin:10px 0;">
        <p>S-Level: <b id="sLevel">S0</b></p>
        <p>Hoa h·ªìng ƒë·ªôi nh√≥m: <b id="sCommissionRate">0%</b></p>
      </div>
    </section>

    <!-- MODALS -->
    <div class="modal" id="registerModal">
      <div class="modal-content">
        <h3 data-i18n-key="reg_modal_title">Ph√≠ ƒëƒÉng k√Ω: 20 000 SML</h3>
        <button onclick="confirmRegister()" data-i18n-key="reg_modal_confirm">X√°c nh·∫≠n</button>
        <button onclick="closeRegisterModal()" data-i18n-key="reg_modal_cancel">H·ªßy</button>
      </div>
    </div>
    <div class="modal" id="depositModal">
      <div class="modal-content">
        <h3 data-i18n-key="dep_modal_title">Chuy·ªÉn USDT BEP20 t·ªõi:</h3>
        <div style="display:flex; align-items:center; justify-content:space-between;">
          <code id="depositAddress">0xYourBEP20AddressHere</code>
          <button class="small" onclick="copyAddress()">Copy</button>
        </div>
        <p><span data-i18n-key="dep_usdt_price">Gi√° USDT:</span> <span id="usdtPrice">26 400</span> VND</p>
        <input type="number" id="depositSML" placeholder="S·ªë SML mu·ªën n·∫°p"/>
        <p id="requiredUSDT">C·∫ßn chuy·ªÉn: 0 USDT</p>
        <button onclick="submitDeposit()" data-i18n-key="dep_modal_confirm">X√°c nh·∫≠n n·∫°p</button>
        <button onclick="closeDepositModal()"  data-i18n-key="dep_modal_cancel">H·ªßy</button>
      </div>
    </div>
    <div class="modal" id="withdrawModal">
      <div class="modal-content">
        <h3 data-i18n-key="wd_modal_title">R√∫t SML (min 1 000 000)</h3>
        <input type="number" id="withdrawAmt" placeholder="S·ªë SML r√∫t"/>
        <button onclick="submitWithdraw()" data-i18n-key="wd_modal_confirm">X√°c nh·∫≠n r√∫t</button>
        <button onclick="closeWithdrawModal()" data-i18n-key="wd_modal_cancel">H·ªßy</button>
      </div>
    </div>

  </div>

  <script>
    // ===== i18n Data & applyLocale =====
    const locales = { /* gi·ªëng nh∆∞ tr∆∞·ªõc */ };
    function applyLocale(lang){ /* gi·ªëng nh∆∞ tr∆∞·ªõc */ }
    document.getElementById('langSelect').addEventListener('change', e=>applyLocale(e.target.value));

    // ===== Login & init =====
    const STORAGE_USER_KEY='smartmall_username';
    let currentUsername='';
    document.addEventListener('DOMContentLoaded', ()=>{
      applyLocale('vi');
      const saved=localStorage.getItem(STORAGE_USER_KEY);
      if(saved){ currentUsername=saved; document.getElementById('login').style.display='none'; document.getElementById('app').style.display='block'; initApp(); }
      document.getElementById('loginBtn').addEventListener('click', handleLogin);
    });
    function handleLogin(){ /* gi·ªëng nh∆∞ tr∆∞·ªõc */ }

    // ===== State =====
    const state={ usdtPrice:26400, walletBalance:100000, registrations:[], products:[], pendingSales:[], userNFT:[], walletHistory:[], requests:[], nftHistory:[], teamSales:0 };
    let selectedDate='';

    // ===== Helpers =====
    function fmt(n){ return n.toLocaleString('vi-VN'); }
    function randomId(){ /* gi·ªëng nh∆∞ tr∆∞·ªõc */ }
    function randomColor(){ /* gi·ªëng nh∆∞ tr∆∞·ªõc */ }
    function addWalletHistory(desc,delta){ /* gi·ªëng nh∆∞ tr∆∞·ªõc */ }
    function showSection(id){ /* gi·ªëng nh∆∞ tr∆∞·ªõc */ }
    function updateWallet(){ /* gi·ªëng nh∆∞ tr∆∞·ªõc */ }

    // ===== initApp =====
    function initApp(){
      /* gi·ªëng nh∆∞ tr∆∞·ªõc, cu·ªëi h√†m g·ªçi: */
      updateVipLevel();
      updateSLevel();
    }

    // ===== Session / Products / NFT / Wallet =====
    /* To√†n b·ªô code x·ª≠ l√Ω phi√™n, s·∫£n ph·∫©m, mua/b√°n, v√≠, l·ªãch s·ª≠ gi·ªëng nh∆∞ b·∫£n tr∆∞·ªõc */

    // ===== Copy address =====
    function copyAddress(){
      const addr=document.getElementById('depositAddress').innerText;
      navigator.clipboard.writeText(addr).then(()=>alert('ƒê√£ sao ch√©p ƒë·ªãa ch·ªâ v√≠!'));
    }

    // ===== VIP & S-Level =====
    function updateVipLevel(){
      const days=state.registrations.length;
      const thresholds=[0,10,20,40,60,90];
      const rates=[1.5,1.6,1.7,1.8,1.9,2.0];
      let lvl=0;
      for(let i=thresholds.length-1;i>=0;i--) if(days>=thresholds[i]){ lvl=i; break; }
      document.getElementById('vipDays').textContent=days;
      document.getElementById('vipLevel').textContent='VIP'+lvl;
      document.getElementById('vipProfitRate').textContent=rates[lvl].toFixed(1)+'%';
    }
    function updateSLevel(){
      const sales=state.teamSales;
      const thresholds=[0,58000000,150000000,1000000000,3000000000,7000000000];
      const comms=[0.0,0.2,0.3,0.4,0.6,0.8];
      let lvl=0;
      for(let i=thresholds.length-1;i>=0;i--) if(sales>=thresholds[i]){ lvl=i; break; }
      document.getElementById('sLevel').textContent='S'+lvl;
      document.getElementById('sCommissionRate').textContent=comms[lvl].toFixed(1)+'%';
    }
    function setTeamSales(amount){
      state.teamSales=amount; updateSLevel(); alert('ƒê√£ c·∫≠p nh·∫≠t doanh s·ªë ƒë·ªôi nh√≥m: '+amount.toLocaleString('vi-VN')+' VND');
    }

    function saveProfile(){ alert('Th√¥ng tin ƒë√£ l∆∞u.'); }
  </script>
</body>
</html>
